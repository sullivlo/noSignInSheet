<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Sample FirebaseUI App</title>

    </head>
    
    <body>
        <!-- sign in widget from firebase UI web-->
        <script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>
        <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyC9Os_I1RJe3ZIf0_0cDvxTzNzwff_kxJI",
            authDomain: "nosigninsheet.firebaseapp.com",
            databaseURL: "https://nosigninsheet.firebaseio.com",
            projectId: "nosigninsheet",
            storageBucket: "nosigninsheet.appspot.com",
            messagingSenderId: "239648283120"
        };
        firebase.initializeApp(config);


         // Get a reference to the database service
        var database = firebase.database();
        console.log(database);
        // Get a reference to the database root
        var root = database.ref();
        console.log(root);
        // Create child node
        var classRoot = root.child("classes");
        console.log(classRoot);
        
        showFirebaseTable();
        
        
        function showFirebaseTable(){

            classRoot.on("child_added", function(snapshot){
            //    console.log(snapshot.key);
            //    console.log(snapshot.val());

            var mySnap =snapshot.val();

            var myKey  = snapshot.key;
            console.log("myKey "+ myKey);
            console.log(mySnap);
             
           
        });
        }
        
        

        
        
        </script>

        <!-- *******************************************************************************************
        * TODO(DEVELOPER): Paste the initialization snippet from:
        * Firebase Console > Overview > Add Firebase to your web app. *
        ***************************************************************************************** -->
        <script type="text/javascript">
            function setUser(user){
                var displayName = user.displayName;
                console.log(displayName);
                var email = user.email;
                var emailVerified = user.emailVerified;
                var photoURL = user.photoURL;
                var uid = user.uid;
                var phoneNumber = user.phoneNumber;
                var providerData = user.providerData;
            }

            initApp = function() {
                firebase.auth().onAuthStateChanged(function(user) {
                if (user) {
                    // User is signed in.
                    console.log("sign in");

                    setUser(user);
                    var displayName = user.displayName;
                    
                    var email = user.email;
                    var emailVerified = user.emailVerified;
                    var photoURL = user.photoURL;
                    var uid = user.uid;
                    var phoneNumber = user.phoneNumber;
                    var providerData = user.providerData;
                    user.getIdToken().then(function(accessToken) {
                    ////document.getElementById('sign-in-status').textContent = 'Signed in';
                    //document.getElementById('sign-in').textContent = 'Sign out';      

                    var _userInfo = JSON.stringify({
                        displayName: displayName,
                        email: email,
                        emailVerified: emailVerified,
                        phoneNumber: phoneNumber,
                        photoURL: photoURL,
                        uid: uid,
                        accessToken: accessToken,
                        providerData: providerData
                    }, null, '  ');

                    // render the user screen with login information                  
                    userHandler(displayName, email);
                     
                    
                    });
                } else {
                    // User is signed out.
                    console.log("sign out");
                    ////document.getElementById('sign-in-status').textContent = 'Signed out';
                    //document.getElementById('sign-in').textContent = 'Sign in';
                    ////document.getElementById('account-details').textContent = 'null';
                }
                }, function(error) {
                console.log(error);
                });
            };

            window.addEventListener('load', function() {
                initApp()
            });

            function addRowFireBase(MydisplayName, myClass, myEmail){

                classRoot.push().set({
                teacher: MydisplayName,
                className: myClass,
                email: myEmail
                
                });
            }
            
            //user variables
            var myName = null;
            var myEmail = null;

            //called from submit button
            function addClassName(){
                console.log("in add class name");
                var myClassName = document.getElementById("ib_ClassName").value;
                console.log(myName + ' ' + myEmail);
                addRowFireBase(myName, myClassName, myEmail);
                
            }
            
            // populate the users logged in screen
            function userHandler(name, email){
                myName = name;
                myEmail = email;
                
            }
            
        </script>
    
    
        <h1>Welcome to My Awesome App</h1>
        <div id="sign-in-status">
            
        </div>
        <img id = "userImg" src="" />
        <div id="sign-in"></div>
        <div id="account-details"></div>
        
        Class name: <input id= "ib_ClassName" type="text" name="FirstName" value=""><br>
        <input type="submit" value="Submit" onclick="addClassName()">
            
        
  </body>